<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>StayZilla BI Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
    {% load static %}
	<!--link rel="{% get_static_prefix %}dashboard/stylesheet/less" href="{% get_static_prefix %}dashboard/less/bootstrap.less" type="text/css" /-->
	<!--link rel="{% get_static_prefix %}dashboard/stylesheet/less" href="{% get_static_prefix %}dashboard/less/responsive.less" type="text/css" /-->
	<!--script src="{% get_static_prefix %}dashboard/js/less-1.3.3.min.js"></script-->
	<!--append ‘#!watch’ to the browser URL, then refresh the page. -->

	<link href="{% get_static_prefix %}dashboard/css/bootstrap.min.css" rel="stylesheet">
	<link href="{% get_static_prefix %}dashboard/css/style.css" rel="stylesheet">

  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="{% get_static_prefix %}dashboard/js/html5shiv.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{% get_static_prefix %}dashboard/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{% get_static_prefix %}dashboard/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{% get_static_prefix %}dashboard/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="{% get_static_prefix %}dashboard/img/apple-touch-icon-57-precomposed.png">
  <link rel="shortcut icon" href="{% get_static_prefix %}dashboard/img/favicon.png">

	<script type="text/javascript" src="{% get_static_prefix %}dashboard/js/jquery.min.js"></script>
	<script type="text/javascript" src="{% get_static_prefix %}dashboard/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="{% get_static_prefix %}dashboard/js/scripts.js"></script>
	<script type="text/javascript" src="{% get_static_prefix %}dashboard/js/highchartsutils.js"></script>

	<script src="http://code.highcharts.com/highcharts.js"></script>
	<script src="http://code.highcharts.com/modules/exporting.js"></script>
</head>

<body>
<div class="container">


<div class="page-header">
  <h1>StayZilla BI Dashboard <small>Dashboard and Trend Analytics</small></h1>
</div>
	<div class="row clearfix" id="row1">
		<div class="col-md-2 column">
		   <div data-spy="affix" id="myAffix">
			<div class="btn-group-vertical">
				 <button class="btn btn-default" type="button" id="pending-number"><em class="glyphicon glyphicon-stats"></em> Pending booking #</button> <button class="btn btn-default" type="button" id="pending-percent"><em class="glyphicon glyphicon-stats"></em> Pending booking %</button>
			</div>
			</div>
		</div>
		<div class="col-md-10 column" id="graph-overview">
			<div id="line1" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
			<div id="bar1" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
			<div id="bar2" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
		</div>
	</div>
	<div class="row clearfix" id="row2">
	    <div class="row clearfix">
    		<div class="col-md-3 column">
    			<div class="dropdown">
    				<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
    					<span class="selection">Select Month</span>
    					<span class="caret"></span>
    				  </button>
    				<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('July')">July</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('August')">August</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('September')">September</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('October')">October</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('November')">November</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateMonth('December')">December</a></li>
    				</ul>
    			</div>
    		</div>
    		<div class="col-md-3 column">
    			<div class="dropdown">
    				<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-expanded="true">
    					<span class="selection">Select # of Top records</span>
    					<span class="caret"></span>
    				  </button>
    				<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateTop('top=5')">5</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateTop('top=10')">10</a></li>
    					<li role="presentation"><a role="menuitem" tabindex="-1" href="#row2" onClick="updateTop('top=15')">15</a></li>
    				</ul>
    			</div>
            </div>
        </div>

			<div class="row clearfix">
				<div class="col-md-6 column">
					<div id="pie1" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
				</div>
				<div class="col-md-6 column">
					<div id="pie2" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
				</div>
			</div>
			<div class="row clearfix">
				<div class="col-md-6 column">
					<div id="pie3" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
				</div>
				<div class="col-md-6 column">
					<div id="pie4" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>
				</div>
			</div>
		</div>
	</div>
</div>



<script>

$(document).ready(function(){

    $("#pending-number").click(function(){
        chartDataUrlCity = "plotgraph_pendingbooking?by=city_code";
        chartDataUrlHotel = "plotgraph_pendingbooking?by=hid";
        chartDataUrlMonth = "plotgraph_pendingbooking?by=month";
        refreshTrend();
	});

    $("#pending-percent").click(function(){
        chartDataUrlCity = "plotgraph_pendingbooking?by=city_code&percent";
        chartDataUrlHotel = "plotgraph_pendingbooking?by=hid&percent";
        chartDataUrlMonth = "plotgraph_pendingbooking?by=month&percent";
        refreshTrend();
	});

});

$('#myAffix').affix({
  offset: {
    bottom: function () {
      return (this.bottom = $('#row2').outerHeight(true))
    }
  }
})

$(".dropdown-menu li a").click(function(){

  $(this).parents(".dropdown").find('.selection').text($(this).text());
  $(this).parents(".dropdown").find('.selection').val($(this).text());

});

var chartDataUrlCity = "plotgraph_pendingbooking?by=city_code";
var chartDataUrlHotel = "plotgraph_pendingbooking?by=hid";
var chartDataUrlMonth = "plotgraph_pendingbooking?by=month";

var bookingURL = "plotgraph_query?for_month=August&need=Booking&based_on=city_code&top=5";
var pendingURL = "plotgraph_query?for_month=August&need=Pending&based_on=city_code&top=5";
var hotelURL = "plotgraph_query?for_month=August&need=Booking&based_on=hid&top=5";
var durationURL = "plotgraph_query?for_month=August&need=duration&based_on=hid&top=5&avg";
var prevMonth = 'August';
var prevTop = 'top=5';

refreshTrend();
refreshPies();

function updateMonth(month) {
    bookingURL = bookingURL.replace(prevMonth, month);
    pendingURL = pendingURL.replace(prevMonth, month);
    hotelURL = hotelURL.replace(prevMonth, month);
    durationURL = durationURL.replace(prevMonth, month);
    if (prevMonth != month)
        refreshPies();
    prevMonth = month;
}

function updateTop(topN) {
    bookingURL = bookingURL.replace(prevTop, topN);
    pendingURL = pendingURL.replace(prevTop, topN);
    hotelURL = hotelURL.replace(prevTop, topN);
    durationURL = durationURL.replace(prevTop, topN);
    if (prevTop != topN)
        refreshPies();
    prevMonth = month;
}


function refreshTrend() {
    $.getJSON(chartDataUrlCity,
    	function(data) {
    		drawBar('#bar1',data['X'] , data['Y'], 'Booking Trend (based on City)');
    });

    $.getJSON(chartDataUrlHotel,
    	function(data) {
    		drawBar('#bar2', data['X'], data['Y'], 'Booking Trend (based on Hotel)');
    });

    $.getJSON(chartDataUrlMonth,
    	function(data) {
    		drawLine('#line1', data['X'], data['Y'], 'StayZilla Booking Trend');
    });
}

function refreshPies() {
    //Row 2

    $.getJSON(bookingURL,
    	function(data) {
    		drawPie('#pie1', data['X'], data['Y'], 'Top Bookings', 'City Code');
    });

    $.getJSON(pendingURL,
    	function(data) {
    		drawPie('#pie2', data['X'], data['Y'], 'Top Pending Bookings', 'City Code');
    });

    $.getJSON(hotelURL,
    	function(data) {
    		drawPie('#pie3', data['X'], data['Y'], 'Avg. Duration of Stay', 'Hotel Id');
    });

    $.getJSON(durationURL,
    	function(data) {
    		drawPie('#pie4', data['X'], data['Y'], 'Bookings based on Hotels', 'Hotel Id');
    });


}

</script>
</body>
</html>
